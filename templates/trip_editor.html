{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css">
<style>
    .point-marker {
        cursor: move;
    }
    .point-marker div {
        width: 8px;
        height: 8px;
        background: #ffffff;
        border: 2px solid #FF5722;
        border-radius: 50%;
        transition: all 0.2s ease;
        box-shadow: 0 0 4px rgba(0, 0, 0, 0.4);
    }
    .point-marker.editable div {
        width: 12px;
        height: 12px;
        cursor: move;
    }
    .point-marker.editable:hover div {
        transform: scale(1.2);
        background: #FF5722;
    }
    .selected-point div {
        background: #FF5722;
        transform: scale(1.2);
        box-shadow: 0 0 8px rgba(255, 87, 34, 0.6);
    }
    .map-container {
        position: relative;
        height: 800px;
    }
    #map {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
    }
    .map-edit-controls {
        position: absolute;
        top: 20px;
        right: 20px;
        z-index: 1000;
        background: rgba(33, 37, 41, 0.9) !important;
        padding: 10px;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    .map-edit-controls .btn-group {
        display: flex;
        gap: 5px;
    }
    .map-edit-controls .btn {
        white-space: nowrap;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    #map.add-point-mode {
        cursor: crosshair;
    }
    .edit-mode-active {
        border: 2px solid #FF5722;
    }
    .map-edit-controls .form-check {
        margin-top: 8px;
    }
    .map-edit-controls .form-check-input {
        cursor: pointer;
    }
    .map-edit-controls .form-check-label {
        cursor: pointer;
        font-size: 0.9rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-3">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>Trip Editor</h1>
        <select class="form-select bg-dark text-white w-auto" id="edit-mode">
            <option value="regular">Regular Trips</option>
            <option value="matched">Matched Trips</option>
        </select>
    </div>

    <!-- Map Card -->
    <div class="card bg-dark border-secondary mb-4">
        <div class="card-body p-0">
            <div class="map-container">
                <div id="map"></div>
                <!-- Map Editing Controls -->
                <div class="map-edit-controls d-none">
                    <div class="btn-group mb-2">
                        <button id="add-point" class="btn btn-sm btn-success">
                            <i class="fas fa-plus"></i> Add
                        </button>
                        <button id="delete-point" class="btn btn-sm btn-danger" disabled>
                            <i class="fas fa-trash"></i> Delete
                        </button>
                        <button id="undo" class="btn btn-sm btn-warning" disabled>
                            <i class="fas fa-undo"></i> Undo
                        </button>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="show-points">
                        <label class="form-check-label text-white" for="show-points">
                            Show Trip Points
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Info and Actions -->
    <div class="row">
        <!-- Trip Info -->
        <div class="col-md-6">
            <div class="card bg-dark border-secondary h-100">
                <div class="card-header border-secondary">
                    <h5 class="mb-0">Selected Trip</h5>
                </div>
                <div class="card-body">
                    <div id="trip-info">
                        <p>No trip selected</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Trip Actions -->
        <div class="col-md-6">
            <div class="card bg-dark border-secondary h-100">
                <div class="card-header border-secondary">
                    <h5 class="mb-0">Actions</h5>
                </div>
                <div class="card-body">
                    <div id="edit-controls" class="d-none">
                        <div class="d-flex gap-2">
                            <button id="save-changes" class="btn btn-success flex-grow-1" disabled>
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                            <button id="discard-changes" class="btn btn-danger flex-grow-1" disabled>
                                <i class="fas fa-times"></i> Discard Changes
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
<script src="https://makinacorpus.github.io/Leaflet.GeometryUtil/leaflet.geometryutil.js"></script>
<script>
    window.skipMainAppInit = true;
</script>
<script src="{{ url_for('static', filename='js/trip_editor.js') }}"></script>
{% endblock %}